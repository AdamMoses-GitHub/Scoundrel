<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A strategic card-based dungeon crawler game">
    <meta name="theme-color" content="#0a0a0a">
    <title>Scoundrel - Deck Dungeon Crawler</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="gameContainer">
        <!-- Main Menu Screen -->
        <div id="mainMenu" class="screen active">
            <h1>‚öîÔ∏è SCOUNDREL ‚öîÔ∏è</h1>
            <p>A deadly card-based dungeon. Draw strength from steel and healing from nature. But beware ‚Äì flee twice in a row and you'll be locked in for the next battle.</p>
            <div class="button-group">
                <button onclick="startGame()">üé≤ START GAME</button>
                <button onclick="showInstructionsFromMenu()">üìñ INSTRUCTIONS</button>
            </div>
        </div>

        <!-- Instructions Screen -->
        <div id="instructions" class="screen">
            <h2>How to Play</h2>
            <div class="instructions-content">
                <h3>The Goal</h3>
                <ul>
                    <li>Survive all 44 cards with your health above 0</li>
                    <li>You start with 20 HP</li>
                </ul>

                <h3>The Deck</h3>
                <ul>
                    <li><strong>Monsters (26):</strong> Black cards (Spades 2-Ace, Clubs 2-Ace) - each deals damage equal to its value</li>
                    <li><strong>Weapons (9):</strong> Diamonds 2-10 - equip to reduce monster damage</li>
                    <li><strong>Potions (9):</strong> Hearts 2-10 - heal for the card's value (one per room only)</li>
                    <li><strong>Total: 44 cards</strong> (red face cards and red Aces have been removed from a standard 52-card deck)</li>
                </ul>

                <h3>Each Room</h3>
                <ul>
                    <li>Four cards are drawn</li>
                    <li><strong>Decide:</strong> You can Flee or Stay</li>
                    <li><strong>If Flee:</strong> All 4 cards go to the bottom of the deck. Cannot flee again next room!</li>
                    <li><strong>If Stay:</strong> Choose 3 of 4 cards to interact with (1 auto-discards)</li>
                </ul>

                <h3>Card Interactions (If You Stay)</h3>
                <ul>
                    <li><strong>Monster:</strong> Choose to fight with weapon or barehanded. Damage = Monster Value - Weapon Value (minimum 0)</li>
                    <li><strong>Weapon:</strong> Equip it (replaces previous weapon). Resets any degradation.</li>
                    <li><strong>Potion:</strong> Heal for its value (only first potion in room works; others ignored)</li>
                </ul>

                <h3>Weapon Degradation</h3>
                <ul>
                    <li>Once a weapon is used on a monster, it can <strong>only be used on weaker monsters</strong> going forward</li>
                    <li><strong>Example:</strong> Use a Diamond 5 on a Jack (11) ‚Üí weapon locked to maximum value 11 ‚Üí next monster of value 12 appears ‚Üí cannot use weapon (need value < 11), must fight barehanded</li>
                    <li><strong>Key Mechanic:</strong> Weapon remembers the strongest monster it fought and can only be used on monsters weaker than that</li>
                    <li>Equipping a new weapon <strong>resets degradation</strong> (new weapon starts fresh)</li>
                    <li>Strategy: Don't waste high-value weapons on weak monsters, and upgrade to better weapons when available</li>
                </ul>

                <h3>Fleeing Rules</h3>
                <ul>
                    <li>You <strong>cannot flee twice in a row</strong> - you must face the next room</li>
                    <li>You can flee any other time (except the final room)</li>
                    <li>When you stay and complete a room normally, the "fled last room" flag resets</li>
                    <li><strong>Final room restriction:</strong> When 4 or fewer cards remain (final room), you cannot flee - you must interact with all remaining cards</li>
                </ul>

                <h3>Final Room</h3>
                <ul>
                    <li>When 4 or fewer cards remain in the deck, the next room is the "final room"</li>
                    <li><strong>In the final room:</strong> Only those remaining cards are drawn (not padded to 4)</li>
                    <li>You must interact with <strong>ALL remaining cards</strong> (not just 3 of 4)</li>
                    <li>You <strong>cannot flee</strong> the final room</li>
                    <li>Any card you don't select carries over to the final room (if more than 4 cards remain initially)</li>
                </ul>

                <h3>Card Carry-Over</h3>
                <ul>
                    <li>If you stay in a room, any cards you don't select are carried over to the next room</li>
                    <li><strong>Example:</strong> 4-card room, you select 3 monsters but skip the potion ‚Üí the potion appears in the next room</li>
                    <li>Carry-over cards appear in the same position they were in the previous room</li>
                    <li>The next room draws fewer new cards to make room for the carry-over card</li>
                </ul>

                <h3>Victory & Defeat</h3>
                <ul>
                    <li><strong>Victory:</strong> Defeat all 44 cards with HP remaining</li>
                    <li><strong>Defeat:</strong> Your HP drops to 0 or below</li>
                </ul>

                <h3>Strategy Tips</h3>
                <ul>
                    <li>Better weapons significantly reduce damage - prioritize them early</li>
                    <li>Potions are valuable but limited - save them for critical situations</li>
                    <li>Fleeing shuffles unprocessed cards to the deck bottom, giving you different rooms</li>
                    <li>Weapon degradation punishes wasting high weapons on weak monsters - plan ahead</li>
                    <li>High monsters early are deadly barehanded - focus on weapons first</li>
                    <li>Plan for the final room: Don't save potions if you'll face it soon</li>
                    <li>Carry-over cards let you escape bad rooms - skip a dangerous card to draw it later</li>
                </ul>

                <div class="button-group" style="margin-top: 40px;">
                    <button onclick="backToMenu()">‚Ü©Ô∏è BACK TO MENU</button>
                </div>
            </div>
        </div>

        <!-- Game Screen -->
        <div id="gameScreen" class="screen">
            <!-- Stats bar: always visible during game -->
            <div id="statsBar"></div>
            
            <!-- Menu dropdown content (positioned relative to stats bar) -->
            <div id="menuDropdownContent" class="dropdown-content">
                <a onclick="toggleLogModal()">üìã View Log</a>
                <a onclick="toggleDiscardModal()">üóëÔ∏è View Discard</a>
                <a onclick="toggleStatsModal()">üìä View Stats</a>
                <a onclick="exitToMenu()">‚Üê Exit to Menu</a>
            </div>
            
            <!-- Interaction count line: always visible while in a room -->
            <div id="interactionCountLine"></div>

            <!-- Game content: changes based on phase -->
            <div id="gameContent">
                <div id="roomDecisionContent"></div>
                <div id="cardInteractionContent"></div>
                <div id="roomCompleteContent"></div>
            </div>

            <!-- Equipped weapon display -->
            <div id="weaponDisplay"></div>
            
            <!-- Log modal popup -->
            <div id="logModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Game Log</h2>
                        <button id="logOrderToggle" class="modal-button" onclick="toggleLogOrder()">‚Üì Newest First</button>
                        <button class="modal-close" onclick="toggleLogModal()">‚úï</button>
                    </div>
                    <div id="logContent" class="modal-body"></div>
                </div>
            </div>

            <!-- Discard pile modal popup -->
            <div id="discardModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Discard Pile</h2>
                        <button class="modal-close" onclick="toggleDiscardModal()">‚úï</button>
                    </div>
                    <div class="modal-body">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <button onclick="toggleDiscardOrder()" style="padding: 8px 16px; font-size: 0.9em;">Reverse Order</button>
                        </div>
                        <div id="discardContent" class="modal-body"></div>
                    </div>
                </div>
            </div>

            <!-- Stats modal popup -->
            <div id="statsModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Game Statistics</h2>
                        <button class="modal-close" onclick="toggleStatsModal()">‚úï</button>
                    </div>
                    <div id="statsContent" class="modal-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div><strong>Games Played:</strong> <span id="gamesPlayed">0</span></div>
                            <div><strong>Games Won:</strong> <span id="gamesWon">0</span></div>
                            <div><strong>Win Rate:</strong> <span id="winRate">0%</span></div>
                            <div><strong>Best Run:</strong> <span id="bestRun">Room 0</span></div>
                            <div><strong>Total Cards Defeated:</strong> <span id="totalCards">0</span></div>
                            <div><strong>Highest HP Reached:</strong> <span id="highestHP">20</span></div>
                            <div><strong>Current Streak:</strong> <span id="currentStreak">0</span></div>
                            <div><strong>Longest Streak:</strong> <span id="longestStreak">0</span></div>
                            <div><strong>Total Times Fled:</strong> <span id="totalFlees">0</span></div>
                        </div>
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="resetStats()" style="padding: 10px 20px; background-color: var(--accent-red); color: white; border: none; border-radius: 4px; cursor: pointer;">üîÑ Reset Statistics</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOverScreen" class="screen"></div>
    </div>

    <!-- Statistics Manager -->
    <script src="js/statsManager.js"></script>
    <!-- Game Engine -->
    <script src="js/game.js"></script>
    <!-- UI Controller -->
    <script src="js/ui.js"></script>
</body>
</html>
