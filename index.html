<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A strategic card-based dungeon crawler game">
    <meta name="theme-color" content="#0a0a0a">
    <title>Scoundrel - Deck Dungeon Crawler</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div id="gameContainer">
        <!-- Main Menu Screen -->
        <div id="mainMenu" class="screen active">
            <h1>‚öîÔ∏è SCOUNDREL ‚öîÔ∏è</h1>
            <p>A deadly card-based dungeon. Draw strength from steel and healing from nature. But beware ‚Äì flee twice in a row and you'll be locked in for the next battle.</p>
            <div class="button-group">
                <button onclick="startGame()">üé≤ START GAME</button>
                <button onclick="showTutorialFromMenu()">üéì TUTORIAL</button>
                <button onclick="showInstructionsFromMenu()">üìñ INSTRUCTIONS</button>
            </div>
            <div style="margin-top: 40px; color: var(--text-secondary); font-size: 0.9em;">
                Created By <a href="http://adammoses.com/more/index.html?theme=fun" target="_blank" rel="noopener noreferrer" style="color: var(--accent-gold); text-decoration: none;">Adam Moses</a>
            </div>
        </div>

        <!-- Instructions Screen -->
        <div id="instructions" class="screen">
            <div class="instructions-header" style="display: flex; flex-direction: column; justify-content: center; align-items: center; border-bottom: 2px solid var(--border-gold); margin-bottom: 20px; padding-bottom: 10px;">
                <button onclick="backFromInstructions()" style="margin-bottom: 20px;">‚Ü©Ô∏è BACK</button>
                <h2 style="border: none; margin: 0; padding: 0;">How to Play</h2>
            </div>
            <div class="instructions-content">
                <p style="margin-bottom: 20px; color: var(--text-secondary); font-style: italic;">
                    This is a digital implementation of the classic card game <a href="http://www.stfj.net/art/2011/Scoundrel.pdf" target="_blank" rel="noopener noreferrer" style="color: var(--accent-gold); text-decoration: none;">Scoundrel</a> by Sivan Tal, freely distributed under Creative Commons.
                </p>

                <h3>The Goal</h3>
                <ul>
                    <li>Survive all 44 cards with your health above 0</li>
                    <li>You start with 20 HP</li>
                </ul>

                <h3>The Deck</h3>
                <ul>
                    <li><strong>Monsters (26):</strong> Black cards (Spades 2-Ace, Clubs 2-Ace) - each deals damage equal to its value</li>
                    <li><strong>Weapons (9):</strong> Diamonds 2-10 - equip to reduce monster damage</li>
                    <li><strong>Potions (9):</strong> Hearts 2-10 - heal for the card's value (one per room only)</li>
                    <li><strong>Total: 44 cards</strong> (red face cards and red Aces have been removed from a standard 52-card deck)</li>
                </ul>

                <h3>Each Room</h3>
                <ul>
                    <li>Four cards are drawn</li>
                    <li><strong>Decide:</strong> You can Flee or Stay</li>
                    <li><strong>If Flee:</strong> All 4 cards go to the bottom of the deck. Cannot flee again next room!</li>
                    <li><strong>If Stay:</strong> Choose 3 of 4 cards to interact with (1 auto-discards)</li>
                </ul>

                <h3>Card Interactions (If You Stay)</h3>
                <ul>
                    <li><strong>Monster:</strong> Choose to fight with weapon or barehanded. Damage = Monster Value - Weapon Value (minimum 0)</li>
                    <li><strong>Weapon:</strong> Equip it (replaces previous weapon). Resets any degradation.</li>
                    <li><strong>Potion:</strong> Heal for its value (only first potion in room works; others ignored)</li>
                </ul>

                <h3>Weapon Degradation</h3>
                <ul>
                    <li>Once a weapon is used on a monster, it can <strong>only be used on weaker monsters</strong> going forward</li>
                    <li><strong>Example:</strong> Use a Diamond 5 on a Jack (11) ‚Üí weapon locked to maximum value 11 ‚Üí next monster of value 12 appears ‚Üí cannot use weapon (need value < 11), must fight barehanded</li>
                    <li><strong>Key Mechanic:</strong> Weapon remembers the strongest monster it fought and can only be used on monsters weaker than that</li>
                    <li>Equipping a new weapon <strong>resets degradation</strong> (new weapon starts fresh)</li>
                    <li>Strategy: Don't waste high-value weapons on weak monsters, and upgrade to better weapons when available</li>
                </ul>

                <h3>Fleeing Rules</h3>
                <ul>
                    <li>You <strong>cannot flee twice in a row</strong> - you must face the next room</li>
                    <li>You can flee any other time (except the final room)</li>
                    <li>When you stay and complete a room normally, the "fled last room" flag resets</li>
                    <li><strong>Final room restriction:</strong> When 4 or fewer cards remain (final room), you cannot flee - you must interact with all remaining cards</li>
                </ul>

                <h3>Final Room</h3>
                <ul>
                    <li>When 4 or fewer cards remain in the deck, the next room is the "final room"</li>
                    <li><strong>In the final room:</strong> Only those remaining cards are drawn (not padded to 4)</li>
                    <li>You must interact with <strong>ALL remaining cards</strong> (not just 3 of 4)</li>
                    <li>You <strong>cannot flee</strong> the final room</li>
                    <li>Any card you don't select carries over to the final room (if more than 4 cards remain initially)</li>
                </ul>

                <h3>Card Carry-Over</h3>
                <ul>
                    <li>If you stay in a room, any cards you don't select are carried over to the next room</li>
                    <li><strong>Example:</strong> 4-card room, you select 3 monsters but skip the potion ‚Üí the potion appears in the next room</li>
                    <li>Carry-over cards appear in the same position they were in the previous room</li>
                    <li>The next room draws fewer new cards to make room for the carry-over card</li>
                </ul>

                <h3>Victory & Defeat</h3>
                <ul>
                    <li><strong>Victory:</strong> Defeat all 44 cards with HP remaining</li>
                    <li><strong>Defeat:</strong> Your HP drops to 0 or below</li>
                </ul>

                <h3>Strategy Tips</h3>
                <ul>
                    <li>Better weapons significantly reduce damage - prioritize them early</li>
                    <li>Potions are valuable but limited - save them for critical situations</li>
                    <li>Fleeing shuffles unprocessed cards to the deck bottom, giving you different rooms</li>
                    <li>Weapon degradation punishes wasting high weapons on weak monsters - plan ahead</li>
                    <li>High monsters early are deadly barehanded - focus on weapons first</li>
                    <li>Plan for the final room: Don't save potions if you'll face it soon</li>
                    <li>Carry-over cards let you escape bad rooms - skip a dangerous card to draw it later</li>
                </ul>

                <div class="button-group" style="margin-top: 40px;">
                    <button id="backFromInstructions" onclick="backFromInstructions()">‚Ü©Ô∏è BACK</button>
                </div>
            </div>
        </div>

        <!-- TUTORIAL SCREEN -->
        <div id="tutorial" class="screen">
            <div class="instructions-header" style="display: flex; flex-direction: column; justify-content: center; align-items: center; border-bottom: 2px solid var(--border-gold); margin-bottom: 20px; padding-bottom: 10px;">
                <button onclick="backFromTutorial()" style="margin-bottom: 20px;">‚Ü©Ô∏è BACK</button>
                <h2 style="border: none; margin: 0; padding: 0;">Tutorial</h2>
            </div>
            <div class="tutorial-content">
                <p>Welcome to the dungeon, Scoundrel. Your goal is simple: <strong>survive the deck</strong>.</p>
                
                <h3>The Core Loop</h3>
                <p>You face a room of <strong>4 cards</strong>. You must interact with (use or discard) at least <strong>3 cards</strong> before you can move to the next room.</p>
                <div class="tutorial-note">
                    <strong>Tip:</strong> If the room is too dangerous, you can <strong>Run Away</strong>! But be warned: you cannot run from two rooms in a row.
                </div>

                <h3>Card Types</h3>
                <ul>
                    <li><strong>Monsters (Spades ‚ô† / Clubs ‚ô£):</strong> Deal damage equal to their value. If you have a weapon equipped, you take (Monster - Weapon) damage.</li>
                    <li><strong>Weapons (Diamonds ‚ô¶):</strong> Equip these to fight. Dealing damage reduces your HP loss.</li>
                    <li>
                        <strong>Health Potions (Hearts ‚ô•):</strong> Restore HP. You cannot heal above 20 HP.
                        <br><em style="color: var(--accent-gold);">Note: Only the first potion you drink in a room heals you. Any others in the same room give 0 HP!</em>
                    </li>
                </ul>

                <h3>Example: A Standard Turn</h3>
                <p>Below is a typical room. Strategic players might try to save a potion for later.</p>
                <div class="tutorial-example">
                    <div class="tutorial-card-row">
                        <!-- Weapon 5 -->
                        <div class="card diamonds">
                            <div class="card-rank">5</div>
                            <div class="card-suit">‚ô¶</div>
                            <div class="card-type">Weapon</div>
                        </div>
                        <!-- Potion 4 -->
                        <div class="card hearts">
                            <div class="card-rank">4</div>
                            <div class="card-suit">‚ô•</div>
                            <div class="card-type">Health</div>
                        </div>
                            <!-- Potion 6 -->
                        <div class="card hearts">
                            <div class="card-rank">6</div>
                            <div class="card-suit">‚ô•</div>
                            <div class="card-type">Health</div>
                        </div>
                        <!-- Monster 8 -->
                        <div class="card spades">
                            <div class="card-rank">8</div>
                            <div class="card-suit">‚ô†</div>
                            <div class="card-type">Monster</div>
                        </div>
                    </div>
                    <p><strong>Option A:</strong> Equip 5‚ô¶. Drink 6‚ô• (Heal 6). Drink 4‚ô• (Heal 0). Leave 8‚ô† (Skipped).</p>
                    <p><strong>Option B (Pro):</strong> Equip 5‚ô¶. Drink 6‚ô• (Heal 6). Fight 8‚ô† (Take 3 dmg). <strong>Leave 4‚ô•</strong> so it appears in the next room (where it will heal you!).</p>
                </div>

                <h3>Example: Managing Carry-Over</h3>
                <p>Any card you do not interact with is placed on top of the deck for the next room.</p>
                <div class="tutorial-example">
                    <div class="tutorial-card-row">
                        <!-- Monster 14 (Dangerous) -->
                        <div class="card spades">
                            <div class="card-rank">14</div>
                            <div class="card-suit">‚ô†</div>
                            <div class="card-type">Monster</div>
                        </div>
                        <!-- Potion 5 -->
                        <div class="card hearts">
                            <div class="card-rank">5</div>
                            <div class="card-suit">‚ô•</div>
                            <div class="card-type">Health</div>
                        </div>
                        <!-- Weapon 3 -->
                        <div class="card diamonds">
                            <div class="card-rank">3</div>
                            <div class="card-suit">‚ô¶</div>
                            <div class="card-type">Weapon</div>
                        </div>
                         <!-- Monster 2 -->
                         <div class="card clubs">
                            <div class="card-rank">2</div>
                            <div class="card-suit">‚ô£</div>
                            <div class="card-type">Monster</div>
                        </div>
                    </div>
                    <p><strong>Scenario:</strong> You have no weapon. The 14‚ô† deals 14 damage!</p>
                    <ul>
                        <li>Interacting with the Potion, Weapon, and Small Monster (2‚ô†) is easy.</li>
                        <li>You <strong>Skip</strong> the 14‚ô†.</li>
                        <li><strong>Next Room:</strong> The 14‚ô† will be the <em>first</em> card you see. You cannot skip it forever, but maybe you'll find a stronger weapon next time!</li>
                    </ul>
                </div>

                <h3>Example: When to Run</h3>
                <p>Sometimes a room is just too deadly. If you haven't fled recently, you can shuffle the entire room back into the deck.</p>
                <div class="tutorial-example">
                    <div class="tutorial-card-row">
                        <div class="card spades"><div class="card-rank">K</div><div class="card-suit">‚ô†</div></div>
                        <div class="card clubs"><div class="card-rank">Q</div><div class="card-suit">‚ô£</div></div>
                        <div class="card spades"><div class="card-rank">J</div><div class="card-suit">‚ô†</div></div>
                        <div class="card hearts"><div class="card-rank">2</div><div class="card-suit">‚ô•</div></div>
                    </div>
                    <p><strong>Total Damage:</strong> 33+! Even with a weapon, this is lethal.</p>
                    <div class="tutorial-note" style="margin: 10px 0;">
                        <strong>Action:</strong> Press <button style="padding: 2px 8px; font-size: 0.8em;">RUN AWAY</button>. All 4 cards go to the bottom of the deck. But you <strong>must</strong> face the next room.
                    </div>
                </div>

                <h3>Example: Weapon Durability</h3>
                <p>Weapons are fragile. They break if you kill a monster that is <strong>weaker</strong> than the last monster it killed.</p>
                <div class="tutorial-example">
                    <div class="tutorial-card-row">
                            <!-- Weapon 7 (Active) -->
                            <div class="card diamonds" style="border-color: #fff; transform: scale(1.1);">
                            <div class="card-rank">7</div>
                            <div class="card-suit">‚ô¶</div>
                            <div class="card-type">Equipped</div>
                        </div>
                            <!-- Monster 6 -->
                        <div class="card clubs">
                            <div class="card-rank">6</div>
                            <div class="card-suit">‚ô£</div>
                            <div class="card-type">Monster</div>
                        </div>
                            <!-- Monster 10 -->
                        <div class="card clubs">
                            <div class="card-rank">10</div>
                            <div class="card-suit">‚ô£</div>
                            <div class="card-type">Monster</div>
                        </div>
                    </div>
                    <p><strong>Scenario:</strong> You are holding a 7‚ô¶ Weapon.</p>
                    <ul>
                        <li><strong>Fighting the 10‚ô£:</strong> You take 3 damage (10-7). The weapon survives because 10 is strong.</li>
                        <li><strong>Fighting the 6‚ô£:</strong> You take 0 damage. However, because 6 is smaller than 7, the <strong>weapon breaks</strong> immediately after!</li>
                    </ul>
                </div>

                <div class="button-group" style="margin-top: 40px;">
                    <button onclick="backFromTutorial()">‚Ü©Ô∏è BACK</button>
                </div>
            </div>
        </div>

        <!-- Game Screen (Grid Layout) -->
        <div id="gameScreen" class="screen">
            <header class="game-header">
                <!-- Stats bar context -->
                <div id="statsBar"></div>
                <!-- Interaction Line -->
                <div id="interactionCountLine"></div>
            </header>

            <main class="game-stage">
                <div id="gameContent">
                    <div id="roomDecisionContent"></div>
                    <div id="cardInteractionContent"></div>
                    <div id="roomCompleteContent"></div>
                </div>
            </main>

            <footer class="game-footer">
                <div id="weaponDisplay"></div>
            </footer>
            
            <!-- Modals -->
            <div id="logModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Game Log</h2>
                        <button id="logOrderToggle" class="modal-button" onclick="toggleLogOrder()">‚Üì Newest First</button>
                        <button class="modal-close" onclick="toggleLogModal()">‚úï</button>
                    </div>
                    <div id="logContent" class="modal-body"></div>
                </div>
            </div>

            <!-- Discard pile modal popup -->
            <div id="discardModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Discard Pile</h2>
                        <button class="modal-close" onclick="toggleDiscardModal()">‚úï</button>
                    </div>
                    <div class="modal-body">
                        <div style="text-align: center; margin-bottom: 15px;">
                            <button onclick="toggleDiscardOrder()" style="padding: 8px 16px; font-size: 0.9em;">Reverse Order</button>
                        </div>
                        <div id="discardContent" class="modal-body"></div>
                    </div>
                </div>
            </div>

            <!-- Stats modal popup -->
            <div id="statsModal" class="modal">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2>Game Statistics</h2>
                        <button class="modal-close" onclick="toggleStatsModal()">‚úï</button>
                    </div>
                    <div id="statsContent" class="modal-body">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 20px;">
                            <div><strong>Games Played:</strong> <span id="gamesPlayed">0</span></div>
                            <div><strong>Games Won:</strong> <span id="gamesWon">0</span></div>
                            <div><strong>Win Rate:</strong> <span id="winRate">0%</span></div>
                            <div><strong>Best Run:</strong> <span id="bestRun">Room 0</span></div>
                            <div><strong>Total Cards Defeated:</strong> <span id="totalCards">0</span></div>
                            <div><strong>Highest HP Reached:</strong> <span id="highestHP">20</span></div>
                            <div><strong>Current Streak:</strong> <span id="currentStreak">0</span></div>
                            <div><strong>Longest Streak:</strong> <span id="longestStreak">0</span></div>
                            <div><strong>Total Times Fled:</strong> <span id="totalFlees">0</span></div>
                        </div>
                        <div style="text-align: center; margin-top: 20px;">
                            <button onclick="resetStats()" style="padding: 10px 20px; background-color: var(--accent-red); color: white; border: none; border-radius: 4px; cursor: pointer;">üîÑ Reset Statistics</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Game Over Screen -->
        <div id="gameOverScreen" class="screen"></div>
    </div>

    <!-- Statistics Manager -->
    <script src="js/statsManager.js"></script>
    <!-- Game Engine -->
    <script src="js/game.js"></script>
    <!-- UI Controller -->
    <script src="js/ui.js"></script>
</body>
</html>
